<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mathematical description of models in the bmstate package ‚Ä¢ bmstate</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mathematical description of models in the bmstate package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bmstate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analysis.html">Time-to-event data analysis with the bmstate package</a></li>
    <li><a class="dropdown-item" href="../articles/exposure-hazard.html">Exposure-hazard multistate modeling with bmstate</a></li>
    <li><a class="dropdown-item" href="../articles/math.html">Mathematical description of models in the bmstate package</a></li>
    <li><a class="dropdown-item" href="../articles/survival.html">Survival data analysis with the bmstate package</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mathematical description of models in the bmstate package</h1>
                        <h4 data-toc-skip class="author">Juho
Timonen</h4>
            
            <h4 data-toc-skip class="date">8th Nov 2025</h4>
      

      <div class="d-none name"><code>math.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://generable.github.io/bmstate/">bmstate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Attached bmstate 0.3.1. Type ?bmstate to get started.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="multistate-hazard-model">Multistate hazard model<a class="anchor" aria-label="anchor" href="#multistate-hazard-model"></a>
</h2>
<div class="section level3">
<h3 id="states-and-transitions">States and transitions<a class="anchor" aria-label="anchor" href="#states-and-transitions"></a>
</h3>
<p>In a multistate model, we can represent the possible
<em>transitions</em> between <em>states</em> as directed edges of a
graph whose
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
nodes correspond to states
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>‚àà</mo><mrow><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>S</mi></mrow></mrow><annotation encoding="application/x-tex">s \in {1, \ldots, S}</annotation></semantics></math>.
The transitions that start from the same node are all at risk
simultaneously when the system is in this state. The transitions that
are at risk simultaneously are competing, meaning that occurrence of one
transition censors the other ones.</p>
<p>Below is an example multistate system.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmat.html">transmat_illnessdeath</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tmat</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/tmat-1.png" class="r-plt" width="336"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmat</span><span class="op">$</span><span class="fu">states_df</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   state_idx    state terminal source</span></span>
<span><span class="co">#&gt; 1         1  Healthy    FALSE   TRUE</span></span>
<span><span class="co">#&gt; 2         2 Diseased    FALSE  FALSE</span></span>
<span><span class="co">#&gt; 3         3     Dead     TRUE  FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmat</span><span class="op">$</span><span class="fu">trans_df</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   trans_idx prev_state state          trans_char trans_type</span></span>
<span><span class="co">#&gt; 1         1          1     2 Healthy -&gt; Diseased          1</span></span>
<span><span class="co">#&gt; 2         2          1     3     Healthy -&gt; Dead          2</span></span>
<span><span class="co">#&gt; 3         3          2     3    Diseased -&gt; Dead          2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hazard-model">Hazard model<a class="anchor" aria-label="anchor" href="#hazard-model"></a>
</h3>
<p>For each transition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>H</mi></mrow><annotation encoding="application/x-tex">h = 1, \ldots, H</annotation></semantics></math>
and observation unit (subject)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">n = 1, \ldots, N</annotation></semantics></math>,
the hazard rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Œª</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda^{(h)}_n(t)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>H</mi></mrow><annotation encoding="application/x-tex">h = 1, \ldots, H</annotation></semantics></math>,
are modeled as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Œª</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Œ≤</mi><msub><mi>T</mi><mi>h</mi></msub><mi>‚ä§</mi></msubsup><msub><mi>ùê±</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\lambda^{(h)}_n(t) = b^{(h)}(t)\exp\left(\beta_{T_h}^{\top} \mathbf{x}_n \right)
</annotation></semantics></math></p>
<p>where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b^{(h)}(t)</annotation></semantics></math>
represents the baseline hazard for transition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>h</mi></msub><annotation encoding="application/x-tex">T_h</annotation></semantics></math>
is an integer indexing the type (<code>trans_type</code>) of transition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><msub><mi>T</mi><mi>h</mi></msub></msub><annotation encoding="application/x-tex">\beta_{T_h}</annotation></semantics></math>
is the regression coefficient for transition type
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>h</mi></msub><annotation encoding="application/x-tex">T_h</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê±</mi><mi>n</mi></msub><annotation encoding="application/x-tex">\mathbf{x}_n</annotation></semantics></math>
includes time-independent covariates for unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
</li>
</ul>
<p>We group transitions that end in the same state together to have the
same transition type.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">el</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lambda[n]^("</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmat</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>edge_labs <span class="op">=</span> <span class="va">el</span>, edge.label.cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/tmat2-1.png" class="r-plt" width="336"></p>
</div>
<div class="section level3">
<h3 id="baseline-hazards">Baseline hazards<a class="anchor" aria-label="anchor" href="#baseline-hazards"></a>
</h3>
<p>Each log baseline hazard
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log b^{(h)}(t)</annotation></semantics></math>
is modeled nonparametrically so that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>b</mi><mn>0</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>+</mo><msup><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\log \left(b^{(h)}(t)\right) = b_0^{(h)} + B^{(h)}(t)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>b</mi><mn>0</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">b_0^{(h)}</annotation></semantics></math>
is a constant and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">B^{(h)}(t)</annotation></semantics></math>
is time-dependent variation modeled using B-splines. The knot locations
for the splines are same for all transitions.</p>
</div>
<div class="section level3">
<h3 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h3>
<p>Currently the package uses a standard normal prior for the
coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
The prior for the weights of the spline basis functions is set
hierarchically so that transitions of same type have a shared mean. Also
the average log hazard rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>b</mi><mn>0</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">b_0^{(h)}</annotation></semantics></math>
have a hierarchical prior so that transitions of the same type have a
shared mean. This prior mean is estimated from the data using a standard
Cox proportional hazards model fit.</p>
<p>You can view the prior in the Stan code for example like this.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stan_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="../reference/default_stan_filepath.html">default_stan_filepath</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">line_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">stan_lines</span>, pattern <span class="op">=</span> <span class="st">"HAZARD PARAM PRIOR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">stan_lines_prior</span> <span class="op">&lt;-</span> <span class="va">stan_lines</span><span class="op">[</span><span class="va">line_idx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">:</span><span class="va">line_idx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">prior_stan_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">stan_lines_prior</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">prior_stan_code</span><span class="op">)</span></span>
<span><span class="co">#&gt;   // HAZARD PARAM PRIOR</span></span>
<span><span class="co">#&gt;   if(do_haz == 1){</span></span>
<span><span class="co">#&gt;     if(nc_haz &gt; 0){</span></span>
<span><span class="co">#&gt;       for(k in 1:nc_haz){</span></span>
<span><span class="co">#&gt;         beta_oth[1, k] ~ normal(0, 2);</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     if(I_xpsr==1){</span></span>
<span><span class="co">#&gt;       beta_xpsr[1, 1] ~ normal(0, 1); // only if has pk submodel</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     // Baseline hazard base level</span></span>
<span><span class="co">#&gt;     sig_w0[1] ~ normal(0, 3);</span></span>
<span><span class="co">#&gt;     to_vector(z_w0[1]) ~ std_normal();</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     // Baseline hazard spline weights</span></span>
<span><span class="co">#&gt;     to_vector(mu_weights[1]) ~ normal(0, 1);</span></span>
<span><span class="co">#&gt;     to_vector(sig_weights[1]) ~ normal(0, 0.3);</span></span>
<span><span class="co">#&gt;     to_vector(z_weights[1]) ~ std_normal();</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   // END HAZARD PARAM PRIOR</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-custom-stan-code">Using custom Stan code<a class="anchor" aria-label="anchor" href="#using-custom-stan-code"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stan_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="../reference/default_stan_filepath.html">default_stan_filepath</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">full_stan_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">stan_lines</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>You should be able to write <code>full_stan_code</code> to some file,
edit that file, and set
<code>options(bmstate_stan_file = path_to_your_file)</code>. If a path
to custom Stan model code has been set, the correctness of package
functionality cannot be guaranteed. However, it should be safe to change
for example just the prior of some parameter from, say,
<code>normal(0, 1)</code> to <code>student_t(4, 0, 1)</code> for
example.</p>
</div>
</div>
<div class="section level2">
<h2 id="likelihood-evaluation">Likelihood evaluation<a class="anchor" aria-label="anchor" href="#likelihood-evaluation"></a>
</h2>
<div class="section level3">
<h3 id="binary-matrix-representation-of-observed-data">Binary matrix representation of observed data<a class="anchor" aria-label="anchor" href="#binary-matrix-representation-of-observed-data"></a>
</h3>
<p>For each subject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">i = 1, \ldots, N</annotation></semantics></math>,
the state transition times divide the follow-up time period into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>i</mi></msub><mo>‚â•</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K_i \geq 1</annotation></semantics></math>
intervals. We assume
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>t</mi><mn>0</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t^{(i)}_0 = 0</annotation></semantics></math>
as the start time of the first interval and for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>‚â•</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k \geq 1</annotation></semantics></math>
use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>t</mi><mi>k</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">t^{(i)}_k</annotation></semantics></math>
to denote the end time of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>th
interval. Furthermore, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>s</mi><mn>0</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">s^{(i)}_0</annotation></semantics></math>
be the initial state and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>s</mi><mi>k</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>‚àà</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>S</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">s^{(i)}_k \in \{1, \ldots, S\}</annotation></semantics></math>
to denote the state that subject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
was in at the end of the time interval.</p>
<p>We use the binary variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Œ¥</mi><mrow><mi>k</mi><mo>,</mo><mi>i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">\delta_{k,i}^{(h)}</annotation></semantics></math>
to indicate whether transition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>‚àà</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>H</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">h \in \{1, \ldots, H\}</annotation></semantics></math>
occurred at the end of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>th
time interval for unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
Another binary variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>I</mi><mrow><mi>k</mi><mo>,</mo><mi>i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">I_{k,i}^{(h)}</annotation></semantics></math>
indicates whether unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
was at risk for transition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
during the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>th
time interval. We collect the entire observed multistate path (event
sequence) data into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêÉ</mi><mtext mathvariant="normal">MS</mtext></msub><mo>=</mo><msubsup><mrow><mo stretchy="true" form="prefix">{</mo><msub><mi>Œî</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùêà</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùê≠</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">}</mo></mrow><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup></mrow><annotation encoding="application/x-tex">\mathbf{D}_{\textrm{MS}} = \left \{\Delta_i, \mathbf{I}_i, \mathbf{t}_i \right\}_{i=1}^N</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œî</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\Delta_i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêà</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{I}_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê≠</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{t}_i</annotation></semantics></math>
contain the transition indicator, risk indicator, and interval time data
for unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
respectively.</p>
<p>We generate example data for a single subject here and plot the
realized path.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2344</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_msm.html">create_msm</a></span><span class="op">(</span><span class="va">tmat</span>, n_grid <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="co"># set very low n_grid for demo</span></span>
<span><span class="va">h0_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1e-3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">set_prior_mean_h0</span><span class="op">(</span><span class="va">h0_true</span><span class="op">)</span> <span class="co"># has no effect for simulation</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span>N_subject <span class="op">=</span> <span class="fl">1</span>, w0 <span class="op">=</span> <span class="va">h0_true</span>, truncate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1 paths</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_paths</span><span class="op">(</span>truncate <span class="op">=</span> <span class="cn">TRUE</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" width="576"></p>
<p>Here we plot the corresponding binary values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Œ¥</mi><mrow><mi>k</mi><mo>,</mo><mn>1</mn></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">\delta_{k,1}^{(h)}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>I</mi><mrow><mi>k</mi><mo>,</mo><mn>1</mn></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">I_{k,1}^{(h)}</annotation></semantics></math>
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>√ó</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">H \times K</annotation></semantics></math>
matrices <code>transition</code> and <code>at_risk</code>,
respectively.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_stan_data.html">create_stan_data</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_stan_data_matrix.html">plot_stan_data_matrix</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">sd</span>, <span class="st">"transition"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_stan_data_matrix.html">plot_stan_data_matrix</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">sd</span>, <span class="st">"at_risk"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" width="576"></p>
</div>
<div class="section level3">
<h3 id="likelihood-formula">Likelihood formula<a class="anchor" aria-label="anchor" href="#likelihood-formula"></a>
</h3>
<p>The log likelihood of the path data is <span class="citation">(Kneib
and Hennerfeind 2008)</span></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùêÉ</mi><mtext mathvariant="normal">MS</mtext></msub><mo>‚à£</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><munderover><mo>‚àë</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>K</mi><mi>i</mi></msub></munderover><munderover><mo>‚àë</mo><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow><mi>H</mi></munderover><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mi>Œ¥</mi><mrow><mi>k</mi><mo>,</mo><mi>i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Œª</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>t</mi><mi>k</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>‚à£</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msubsup><mtext mathvariant="normal">I</mtext><mrow><mi>k</mi><mo>,</mo><mi>i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><msubsup><mo>‚à´</mo><msubsup><mi>t</mi><mrow><mi>k</mi><mo>‚àí</mo><mn>1</mn></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><msubsup><mi>t</mi><mi>k</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup></msubsup><msubsup><mi>Œª</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>‚à£</mo><mi>Œ∏</mi><mo stretchy="true" form="postfix">)</mo></mrow><mtext mathvariant="normal">d</mtext><mi>t</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\label{eq: mslik}
\log p(\mathbf{D}_{\textrm{MS}} \mid \theta) = \sum_{i=1}^{N} \sum_{k=1}^{K_i}\sum_{h=1}^H\left[\delta_{k,i}^{(h)}\log\left(\lambda_i^{(h)}(t^{(i)}_k \mid \theta) \right) - \text{I}_{k,i}^{(h)} \int_{t^{(i)}_{k-1}}^{t^{(i)}_{k}} \lambda_i^{(h)}(t \mid \theta) \text{d}t \right]
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ∏</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>Œ∏</mi><mn>0</mn></msub><mo>,</mo><mi>Œ≤</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\theta = \{\theta_0, \beta\}</annotation></semantics></math>
contains the baseline hazard parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_0</annotation></semantics></math>
and regression coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≤</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="numerical-integration">Numerical integration<a class="anchor" aria-label="anchor" href="#numerical-integration"></a>
</h3>
<p>The package relies on numerical integration of the hazard functions
to evaluate the likelihood. The integration step size is the max time
divided by number of grid points, which we can check here.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delta_grid</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">get_tmax</span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="va">mod</span><span class="op">$</span><span class="fu">get_n_grid</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">delta_grid</span>, <span class="va">sd</span><span class="op">$</span><span class="va">delta_grid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"expected delta_grid"</span>, <span class="st">"found delta_grid"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="co">#&gt; expected delta_grid    found delta_grid </span></span>
<span><span class="co">#&gt;            83.33333            83.33333</span></span></code></pre></div>
<p>We demonstrate the integration grid with an example hazard
function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">h0</span> <span class="op">&lt;-</span> <span class="fl">0.001</span></span>
<span><span class="fu"><a href="../reference/plot_stan_data_integral.html">plot_stan_data_integral</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">sd</span>, <span class="fl">1</span>, <span class="va">h0</span>, <span class="va">w</span><span class="op">)</span> <span class="co"># first interval</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_stan_data_integral.html">plot_stan_data_integral</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">sd</span>, <span class="fl">2</span>, <span class="va">h0</span>, <span class="va">w</span><span class="op">)</span> <span class="co"># second interval</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-7-2.png" class="r-plt" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="state-visit-risk-prediction">State visit risk prediction<a class="anchor" aria-label="anchor" href="#state-visit-risk-prediction"></a>
</h2>
<p>We often ultimately want the model to be able to predict, for a given
subject, the probability that a particular state is visited at least
once before time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
given an initial state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mn>0</mn></msub><annotation encoding="application/x-tex">s_0</annotation></semantics></math>
at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>0</mn></msub><annotation encoding="application/x-tex">t_0</annotation></semantics></math>.
We denote this probability by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>‚à£</mo><mi>t</mi><mo>,</mo><msub><mi>s</mi><mn>0</mn></msub><mo>,</mo><msub><mi>t</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(s \mid t, s_0, t_0)</annotation></semantics></math>.</p>
<div class="section level3">
<h3 id="path-generation">Path generation<a class="anchor" aria-label="anchor" href="#path-generation"></a>
</h3>
<p>For any subject, which does not need to be part of the training data,
we can generate a number of state paths starting from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mn>0</mn></msub><annotation encoding="application/x-tex">s_0</annotation></semantics></math>
at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>0</mn></msub><annotation encoding="application/x-tex">t_0</annotation></semantics></math>.
This can be done via the <code><a href="../reference/generate_paths.html">generate_paths()</a></code> function. For
drawing the arrival times for a non-homogeneous Poisson process in path
generation, we use the thinning algorithm <span class="citation">(Lewis
and Shedler 1979)</span>.</p>
<p>The probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>‚à£</mo><mi>t</mi><mo>,</mo><msub><mi>s</mi><mn>0</mn></msub><mo>,</mo><msub><mi>t</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(s \mid t, s_0, t_0)</annotation></semantics></math>
can then be estimated as the proportion of paths in which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
was visited before time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
This can be done via the function
<code><a href="../reference/p_state_visit_per_subject.html">p_state_visit_per_subject()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="kolmogorov-forward-equations">Kolmogorov forward equations<a class="anchor" aria-label="anchor" href="#kolmogorov-forward-equations"></a>
</h3>
<div class="section level4">
<h4 id="generator-matrix">Generator matrix<a class="anchor" aria-label="anchor" href="#generator-matrix"></a>
</h4>
<p>If the transition matrix of the multistate model has no self-loops,
it is a continuous-time Markov process <span class="citation">(Norris
1997)</span>. In this special case, we can define a generator matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêê</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>q</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{Q}(t) = [q_{jk}(t)]</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">q_{kj}(t)</annotation></semantics></math>
is called the transition rate from state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
to state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.
The transition rate for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>‚â†</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">k \neq j</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
if the corresponding transition is not possible, and otherwise it is
given by the corresponding hazard function. Additionally,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mrow><mi>k</mi><mi>k</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>‚àí</mo><munder><mo>‚àë</mo><mrow><mi>j</mi><mo>‚â†</mo><mi>k</mi></mrow></munder><msub><mi>q</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
q_{kk}(t) = -\sum_{j \neq k} q_{kj}(t)
\end{equation}</annotation></semantics></math> for all diagonal values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>‚àà</mo><mrow><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>S</mi></mrow></mrow><annotation encoding="application/x-tex">k \in {1, \ldots, S}</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="transition-probability-matrix">Transition probability matrix<a class="anchor" aria-label="anchor" href="#transition-probability-matrix"></a>
</h4>
<p>We also define a transition probability matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêè</mi><msub><mi>t</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{P}_{t_0}(t)</annotation></semantics></math>,
where the element on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
row and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>th
column is the probability that the process is in state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
given that it started in state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>0</mn></msub><annotation encoding="application/x-tex">t_0</annotation></semantics></math>.
The Kolmogorov forward equations are
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mtext mathvariant="normal">d</mtext><mrow><mtext mathvariant="normal">d</mtext><mi>t</mi></mrow></mfrac><msub><mi>ùêè</mi><msub><mi>t</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>ùêè</mi><msub><mi>t</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ùêê</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
\frac{\text{d}}{\text{d}t} \mathbf{P}_{t_0}(t) = \mathbf{P}_{t_0}(t) \mathbf{Q}(t),
\end{equation}</annotation></semantics></math> and we can solve
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêè</mi><msub><mi>t</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{P}_{t_0}(t)</annotation></semantics></math>
using the initial condition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêè</mi><msub><mi>t</mi><mn>0</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">\mathbf{P}_{t_0}(t_0) = I</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="state-occupancy-probability">State occupancy probability<a class="anchor" aria-label="anchor" href="#state-occupancy-probability"></a>
</h4>
<p>The function <code><a href="../reference/p_state_occupancy.html">p_state_occupancy()</a></code> can be used to compute,
for a set of output times
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi mathvariant="normal">e</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">d</mi></mrow></msub><annotation encoding="application/x-tex">t_{\mathrm{end}}</annotation></semantics></math>,
the probability that a subject occupies the a certain state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
given their state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mn>0</mn></msub><annotation encoding="application/x-tex">s_0</annotation></semantics></math>
at the initial time. For terminal states, the state occupancy
probability at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is the state visit probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>‚à£</mo><mi>t</mi><mo>,</mo><msub><mi>s</mi><mn>0</mn></msub><mo>,</mo><msub><mi>t</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(s \mid t, s_0, t_0)</annotation></semantics></math>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="examples-of-multistate-models">Examples of multistate models<a class="anchor" aria-label="anchor" href="#examples-of-multistate-models"></a>
</h2>
<p>In this section, we illustrate some common multistate models.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_sub</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Plot event time distribution</span></span>
<span><span class="va">plot_time_dist</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">checkmate</span><span class="fu">::</span><span class="fu"><a href="https://mllg.github.io/checkmate/reference/checkNumeric.html" class="external-link">assert_numeric</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Time <span class="op">=</span> <span class="va">t</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggdist</span><span class="fu">::</span><span class="fu"><a href="https://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>      mapping <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"gray20"</span>,</span>
<span>      lty <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="basic-survival-model">Basic survival model<a class="anchor" aria-label="anchor" href="#basic-survival-model"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmat.html">transmat_survival</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="va">tm</span><span class="op">$</span><span class="va">states</span></span></code></pre></div>
<p>The basic survival model can be seen as a multistate model with two
states: Alive and Dead. The death <em>event</em> corresponds to
transitioning from the state Alive to the terminal state Dead. First we
create a <code>TransitionMatrix</code>. The transition matrix is a
directed graph encoded by a binary matrix.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Alive Dead</span></span>
<span><span class="co">#&gt; Alive     0    1</span></span>
<span><span class="co">#&gt; Dead      0    0</span></span>
<span><span class="va">tm</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" width="480"></p>
<p>Then we create a <code>MultistateModel</code> using this graph.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">365.25</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_msm.html">create_msm</a></span><span class="op">(</span><span class="va">tm</span>, t_max <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; A MultistateModel with:</span></span>
<span><span class="co">#&gt;  - Hazard covariates: {}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A MultistateSystem with:</span></span>
<span><span class="co">#&gt;  - States: {Alive, Dead}</span></span>
<span><span class="co">#&gt;  - Number of spline knots: 5</span></span></code></pre></div>
<p>Now we can simulate death events with known constant hazard rate
<code>lambda</code>. For this model, the event times should follow an
exponential distribution with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mi>Œª</mi></mfrac><annotation encoding="application/x-tex">\frac{1}{\lambda}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1e-2</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_paths</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_graph</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-12-2.png" class="r-plt" width="480"></p>
<p>We plot the distribution of event times (i.e., transition times) and
the theoretical mean (red line).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">transition_times</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">plot_time_dist</span><span class="op">(</span><span class="va">times</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">lambda</span>, color <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" width="480"></p>
<p>Here generate paths with a lower hazard so that they can get censored
before the follow-up ends. We compute the risk of death based on paths
and ensure that it is correct, by comparing to two different more
analytic implementations of solving a transition probability matrix.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1) This is the general way using the package</span></span>
<span><span class="va">solve_p</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">lambda</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">mod</span><span class="op">$</span><span class="va">system</span><span class="op">$</span><span class="fu">get_tmax</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/solve_trans_prob_matrix.html">solve_trans_prob_matrix</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">system</span>, t_out <span class="op">=</span> <span class="va">tt</span>, log_w0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">P</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2) This is a special case which can be used if the baseline hazards are constant,</span></span>
<span><span class="co"># currently not in the package but we use it to validate that we get the</span></span>
<span><span class="co"># Same result</span></span>
<span><span class="va">solve_P_consthaz</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">h0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">Q_true</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">system</span><span class="op">$</span><span class="fu">intensity_matrix</span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">system</span><span class="op">$</span><span class="fu">get_tmax</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">h0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/expm-methods.html" class="external-link">expm</a></span><span class="op">(</span><span class="va">Q_true</span> <span class="op">*</span> <span class="va">mod</span><span class="op">$</span><span class="va">system</span><span class="op">$</span><span class="fu">get_tmax</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1e-3</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">solve_p</span><span class="op">(</span><span class="va">mod</span>, <span class="va">lambda</span><span class="op">)</span></span>
<span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu">solve_P_consthaz</span><span class="op">(</span><span class="va">mod</span>, <span class="va">lambda</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/p_state_visit.html">p_state_visit</a></span><span class="op">(</span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">)</span><span class="op">$</span><span class="va">prob</span>, <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">P</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Paths"</span>, <span class="st">"Analytic1"</span>, <span class="st">"Analytic2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Paths Analytic1 Analytic2 </span></span>
<span><span class="co">#&gt; 0.6500000 0.6657109 0.6657112</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="competing-risks-model">Competing risks model<a class="anchor" aria-label="anchor" href="#competing-risks-model"></a>
</h3>
<p>The transition matrix is for a competing risks model can be created
like so.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmat.html">transmat_comprisk</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A B C D</span></span>
<span><span class="co">#&gt; A 0 1 1 1</span></span>
<span><span class="co">#&gt; B 0 0 0 0</span></span>
<span><span class="co">#&gt; C 0 0 0 0</span></span>
<span><span class="co">#&gt; D 0 0 0 0</span></span>
<span><span class="va">tm</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-15-1.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_msm.html">create_msm</a></span><span class="op">(</span><span class="va">tm</span>, t_max <span class="op">=</span> <span class="va">tmax</span><span class="op">)</span></span></code></pre></div>
<p>This model has 3 possible transitions. Now we can simulate transition
times with known constant hazard rates <code>lambda_1</code>,
<code>lambda_2</code>, <code>lambda_3</code>. Simulating the transition
times is mathematically equivalent to simulating from independent
homogeneous Poisson processes with rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œª</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\lambda_i</annotation></semantics></math>,
and taking the transition that occurred first. This means that the
transition probabilities should be
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><msub><mi>Œª</mi><mi>i</mi></msub><mrow><munderover><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></munderover><msub><mi>Œª</mi><mi>j</mi></msub></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
P(i) = \frac{\lambda_i}{\sum_{j=1}^ 3 \lambda_j}.
</annotation></semantics></math></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1e-2</span></span>
<span><span class="va">w0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lambda</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">lambda</span>, <span class="fl">3</span> <span class="op">*</span> <span class="va">lambda</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">w0</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1666667 0.3333333 0.5000000</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="va">w0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_paths</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-17-1.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_graph</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-17-2.png" class="r-plt" width="480"></p>
<p>The distribution of event times should be exponentially distributed
with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><msub><mi>Œª</mi><mn>0</mn></msub></mfrac><annotation encoding="application/x-tex">\frac{1}{\lambda_0}</annotation></semantics></math>
where
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œª</mi><mn>0</mn></msub><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mn>3</mn></munderover><msub><mi>Œª</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">
\lambda_0 = \sum_{j=1}^ 3 \lambda_j
</annotation></semantics></math> is the combined hazard rate. We plot
the empirical distribution and the theoretical mean (red line).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">as_transitions</span><span class="op">(</span>truncate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="fu">plot_time_dist</span><span class="op">(</span><span class="va">times</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w0</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-18-1.png" class="r-plt" width="480"></p>
<p>Here we again generate paths with a lower hazard so that they can get
censored before the follow-up ends. We compute the probability of
different terminal states at the end of follow up based on paths and
ensure that they are correct.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="fl">0.01</span> <span class="op">*</span> <span class="va">w0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">solve_p</span><span class="op">(</span><span class="va">mod</span>, <span class="fl">0.01</span> <span class="op">*</span> <span class="va">w0</span><span class="op">)</span></span>
<span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu">solve_P_consthaz</span><span class="op">(</span><span class="va">mod</span>, <span class="fl">0.01</span> <span class="op">*</span> <span class="va">w0</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/p_state_visit.html">p_state_visit</a></span><span class="op">(</span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">)</span><span class="op">$</span><span class="va">prob</span>, <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">P</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Paths"</span>, <span class="st">"Analytic1"</span>, <span class="st">"Analytic2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"P(state = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt;           P(state = B) P(state = C) P(state = D)</span></span>
<span><span class="co">#&gt; Paths       0.08100000    0.1440000    0.2380000</span></span>
<span><span class="co">#&gt; Analytic1   0.08030481    0.1606096    0.2409144</span></span>
<span><span class="co">#&gt; Analytic2   0.08030484    0.1606097    0.2409145</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="illness-death-model">Illness-death model<a class="anchor" aria-label="anchor" href="#illness-death-model"></a>
</h3>
<p>The illness-death model is another common multistate model.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmat.html">transmat_illnessdeath</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Healthy Diseased Dead</span></span>
<span><span class="co">#&gt; Healthy        0        1    1</span></span>
<span><span class="co">#&gt; Diseased       0        0    1</span></span>
<span><span class="co">#&gt; Dead           0        0    0</span></span>
<span><span class="va">tm</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-20-1.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_msm.html">create_msm</a></span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span>
<span><span class="va">w0</span> <span class="op">&lt;-</span> <span class="fl">1e-2</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="va">w0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_paths</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-20-2.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_graph</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-20-3.png" class="r-plt" width="480"></p>
<p>Here we again generate paths with a lower hazard so that they can get
censored before the follow-up ends. We compute the probability of death
before the end of follow up based on paths and ensure that it is
correct.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h0_true</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fl">1e-3</span></span>
<span><span class="va">h0_true_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">h0_true</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">h0_true_vec</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">h0_true</span></span>
<span><span class="va">h0_true_vec</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">*</span> <span class="va">h0_true</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="va">h0_true_vec</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">solve_p</span><span class="op">(</span><span class="va">mod</span>, <span class="va">h0_true_vec</span><span class="op">)</span></span>
<span><span class="va">P_true</span> <span class="op">&lt;-</span> <span class="fu">solve_P_consthaz</span><span class="op">(</span><span class="va">mod</span>, <span class="va">h0_true_vec</span><span class="op">)</span></span>
<span><span class="va">p_death1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p_state_visit.html">p_state_visit</a></span><span class="op">(</span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">)</span><span class="op">$</span><span class="va">prob</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">p_death2</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">p_death3</span> <span class="op">&lt;-</span> <span class="va">P_true</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p_death1</span>, <span class="va">p_death2</span>, <span class="va">p_death3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Paths"</span>, <span class="st">"Analytic"</span>, <span class="st">"Analytic2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Paths  Analytic Analytic2 </span></span>
<span><span class="co">#&gt; 0.3110000 0.2961619 0.2961618</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="diamond-model">Diamond model<a class="anchor" aria-label="anchor" href="#diamond-model"></a>
</h3>
<p>This model is a more complex multistate model.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmat.html">transmat_diamond</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A B C D</span></span>
<span><span class="co">#&gt; A 0 1 1 1</span></span>
<span><span class="co">#&gt; B 0 0 1 1</span></span>
<span><span class="co">#&gt; C 0 1 0 1</span></span>
<span><span class="co">#&gt; D 0 0 0 0</span></span>
<span><span class="va">tm</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-22-1.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_msm.html">create_msm</a></span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span>
<span><span class="va">w0</span> <span class="op">&lt;-</span> <span class="fl">1e-2</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="va">w0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_paths</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-22-2.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_graph</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-22-3.png" class="r-plt" width="480"></p>
<p>Here we again generate paths with a lower hazard so that they can get
censored before the follow-up ends. We compute the probability of death
before the end of follow up based on paths and ensure that it is
correct.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h0_true</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fl">1e-3</span></span>
<span><span class="va">h0_true_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">h0_true</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">h0_true_vec</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">h0_true</span></span>
<span><span class="va">h0_true_vec</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">*</span> <span class="va">h0_true</span></span>
<span><span class="va">h0_true_vec</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">20</span> <span class="op">*</span> <span class="va">h0_true</span></span>
<span></span>
<span><span class="va">P_true</span> <span class="op">&lt;-</span> <span class="fu">solve_P_consthaz</span><span class="op">(</span><span class="va">mod</span>, <span class="va">h0_true_vec</span><span class="op">)</span></span>
<span><span class="va">p_death3</span> <span class="op">&lt;-</span> <span class="va">P_true</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">w0</span> <span class="op">&lt;-</span> <span class="va">h0_true_vec</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="va">w0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">solve_p</span><span class="op">(</span><span class="va">mod</span>, <span class="va">w0</span><span class="op">)</span></span>
<span><span class="va">p_death1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p_state_visit.html">p_state_visit</a></span><span class="op">(</span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">)</span><span class="op">$</span><span class="va">prob</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">p_death2</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p_death1</span>, <span class="va">p_death2</span>, <span class="va">p_death3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Paths"</span>, <span class="st">"Analytic"</span>, <span class="st">"Analytic2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Paths  Analytic Analytic2 </span></span>
<span><span class="co">#&gt; 0.5270000 0.5459059 0.5459058</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="general-multistate-models">General multistate models<a class="anchor" aria-label="anchor" href="#general-multistate-models"></a>
</h3>
<p>General multistate models can have multiple terminal states and
various transitions.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmat.html">transmat_full</a></span><span class="op">(</span>state_names <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, sources <span class="op">=</span> <span class="fl">1</span>, terminal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A B C D E</span></span>
<span><span class="co">#&gt; A 0 1 1 1 1</span></span>
<span><span class="co">#&gt; B 0 1 1 1 1</span></span>
<span><span class="co">#&gt; C 0 1 1 1 1</span></span>
<span><span class="co">#&gt; D 0 0 0 0 0</span></span>
<span><span class="co">#&gt; E 0 0 0 0 0</span></span>
<span><span class="va">tm</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-24-1.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_msm.html">create_msm</a></span><span class="op">(</span><span class="va">tm</span><span class="op">)</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate_data</span><span class="op">(</span><span class="va">N_sub</span>, w0 <span class="op">=</span> <span class="fl">1e-3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating 1000 paths</span></span>
<span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_paths</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-24-2.png" class="r-plt" width="480"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">plot_graph</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="math_files/figure-html/unnamed-chunk-24-3.png" class="r-plt" width="480"></p>
<p>Some of the paths may not reach a terminal state before
<code>t_max</code>, meaning they get censored.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span><span class="op">$</span><span class="va">paths</span><span class="op">$</span><span class="fu">prop_matrix</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     to</span></span>
<span><span class="co">#&gt; from         A         B         C         D         E  no event</span></span>
<span><span class="co">#&gt;    A 0.0000000 0.2600000 0.2550000 0.2380000 0.2330000 0.0140000</span></span>
<span><span class="co">#&gt;    B 0.0000000 0.2339545 0.2091097 0.2070393 0.2111801 0.1387164</span></span>
<span><span class="co">#&gt;    C 0.0000000 0.2412281 0.2192982 0.1973684 0.2302632 0.1118421</span></span>
<span><span class="co">#&gt;    D 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 1.0000000</span></span>
<span><span class="co">#&gt;    E 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 1.0000000</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-kneib2008" class="csl-entry">
Kneib, Thomas, and Andrea Hennerfeind. 2008. <span>‚ÄúBayesian Semi
Parametric Multi-State Models.‚Äù</span> <em>Statistical Modelling</em> 8:
169‚Äì98. <a href="https://api.semanticscholar.org/CorpusID:1219145" class="external-link">https://api.semanticscholar.org/CorpusID:1219145</a>.
</div>
<div id="ref-lewis1979" class="csl-entry">
Lewis, P. A. W., and G. S. Shedler. 1979. <span>‚ÄúSimulation of
Nonhomogeneous Poisson Processes with Degree-Two Exponential Polynomial
Rate Function.‚Äù</span> <em>Operations Research</em> 27 (5): 1026‚Äì40.
</div>
<div id="ref-norris1997" class="csl-entry">
Norris, J. R. 1997. <em>Markov Chains</em>. Cambridge: Cambridge
University Press.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Juho Timonen, Generable.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
