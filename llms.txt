# bmstate

R package for Bayesian multistate modeling.

## Installation

- Install `cmdstanr` following the instructions
  [here](https://mc-stan.org/cmdstanr/).
- Install `bmstate` using

``` r
remotes::install_github("generable/bmstate", ref = "main", build_vignettes = TRUE)
```

Building the vignettes can take some time, so consider using
`build_vignettes = FALSE`. Use `ref = "develop"` if you want the current
development version.

## Getting started

More info is in the documentation, which you can view with

``` r
library(bmstate)
?bmstate
```

See also the vignettes.

## Development

### Versioning

The package mostly conforms to [semantic
versioning](https://semver.org/). The version number has the format
`MAJOR.MINOR.PATCH`, where

- `MAJOR` is incremented if incompatible API changes are made
- `MINOR` version is incremented if significant new functionality is
  added
- `PATCH` version is incremented when making small bug fixes, very minor
  new functionality, improved documentation or new or improved vignettes

The version update can be done with `usethis::use_version()`.

### Development branches

When starting a new feature or a bug fix, create a branch off the
`develop` branch. The version in the `develop` branch should be
something like `MAJOR.MINOR.PATCH.9000` where `MAJOR.MINOR.PATCH` is the
version that exists in the `main` branch. This increment can be done
with `usethis::use_dev_version()`. When finishing the edits, create a PR
to `develop`. Before the `develop` branch is merged to `main`, the patch
version should be incremented. Also, make sure to run

- `styler::style_dir()` in the package root directory.
- `devtools::document()`
- `R CMD check`

### Known NOTEs in R CMD check

- The exported Stan functions seem to have no bindings in R code

&nbsp;

       Undefined global functions or variables:
         compute_log_hazard_multiplier compute_theta_pk
         pop_2cpt_partly_ss_stage1 pop_2cpt_partly_ss_stage2

- Other

&nbsp;

    ❯ checking package dependencies ... NOTE
      Imports includes 22 non-default packages.
      Importing from so many packages makes the package vulnerable to any of
      them becoming unavailable.  Move as many as possible to Suggests and
      use conditionally.

    ❯ checking for future file timestamps ... NOTE
      unable to verify current time

    ❯ checking dependencies in R code ... NOTE
      Namespaces in Imports field not imported from:
        ‘Matrix’ ‘msm’ ‘mstate’
        All declared Imports should be used.

There should not be errors or warnings.

# Package index

## All functions

- [`DosingData`](https://generable.github.io/bmstate/reference/DosingData.md)
  : Dosing data class (R6 class)
- [`JointData`](https://generable.github.io/bmstate/reference/JointData.md)
  : Joint data class (R6 class)
- [`MultistateModel`](https://generable.github.io/bmstate/reference/MultiStateModel.md)
  : Main model class
- [`MultistateModelFit`](https://generable.github.io/bmstate/reference/MultistateModelFit.md)
  : Minimal fit class
- [`MultistateSystem`](https://generable.github.io/bmstate/reference/MultistateSystem.md)
  : A multistate system with proportional spline hazards
- [`PKModel`](https://generable.github.io/bmstate/reference/PKModel.md)
  : One-compartment PK Model
- [`PSSDosingData`](https://generable.github.io/bmstate/reference/PSSDosingData.md)
  : Partially steady-state dosing data class (R6 class)
- [`PathData`](https://generable.github.io/bmstate/reference/PathData.md)
  : Path data class (R6 class)
- [`TransitionMatrix`](https://generable.github.io/bmstate/reference/TransitionMatrix.md)
  : Defines states and possible transitions
- [`as_any_event()`](https://generable.github.io/bmstate/reference/as_any_event.md)
  : PathData to time-to-event data format for any state other than null
  state
- [`as_single_event()`](https://generable.github.io/bmstate/reference/as_single_event.md)
  : PathData to time-to-event data format with a single event
- [`as_survival()`](https://generable.github.io/bmstate/reference/as_survival.md)
  : PathData to event-free survival format
- [`bmstate-package`](https://generable.github.io/bmstate/reference/bmstate-package.md)
  [`bmstate`](https://generable.github.io/bmstate/reference/bmstate-package.md)
  : The 'bmstate' package.
- [`c_index()`](https://generable.github.io/bmstate/reference/c_index.md)
  : Compute concordance index
- [`create_msm()`](https://generable.github.io/bmstate/reference/create_msm.md)
  : Create a multistate model
- [`create_scoring_df()`](https://generable.github.io/bmstate/reference/create_scoring_df.md)
  : Create a data frame to evaluate state visit probability predictions
- [`create_stan_data()`](https://generable.github.io/bmstate/reference/create_stan_data.md)
  : Creating Stan data list
- [`create_stan_model()`](https://generable.github.io/bmstate/reference/create_stan_model.md)
  : Create the main 'Stan' model
- [`default_stan_filepath()`](https://generable.github.io/bmstate/reference/default_stan_filepath.md)
  : Get path to default Stan file
- [`df_to_pathdata()`](https://generable.github.io/bmstate/reference/df_to_pathdata.md)
  : Create 'PathData' from a data frame of one observed path per subject
- [`ensure_exposed_stan_functions()`](https://generable.github.io/bmstate/reference/ensure_exposed_stan_functions.md)
  : Expose 'Stan' functions if they are not yet exposed
- [`example_sim_setup_illnessdeath()`](https://generable.github.io/bmstate/reference/example_sim_setup_illnessdeath.md)
  : Example simulation setup
- [`fit_coxph()`](https://generable.github.io/bmstate/reference/fit_coxph.md)
  : Fit Cox PH model using Breslow method
- [`fit_stan()`](https://generable.github.io/bmstate/reference/fit_stan.md)
  : Fit a model using 'Stan'
- [`generate_paths()`](https://generable.github.io/bmstate/reference/generate_paths.md)
  : Path generation for 'MultistateModelFit'
- [`msfit_average_hazard()`](https://generable.github.io/bmstate/reference/msfit_average_hazard.md)
  : Estimate average hazard of an 'msfit'
- [`msfit_plot_cumhaz()`](https://generable.github.io/bmstate/reference/msfit_plot_cumhaz.md)
  : Plot cumulative hazard of 'msfit'
- [`msmfit_exposure()`](https://generable.github.io/bmstate/reference/msmfit_exposure.md)
  : Compute exposure
- [`msmfit_inst_hazard_param_draws()`](https://generable.github.io/bmstate/reference/msmfit_inst_hazard_param_draws.md)
  : Extract and reshape draws of instant hazard related parameters
- [`msmfit_log_hazard_multipliers()`](https://generable.github.io/bmstate/reference/msmfit_log_hazard_multipliers.md)
  : Compute log_hazard multipliers
- [`msmfit_pk_params()`](https://generable.github.io/bmstate/reference/msmfit_pk_params.md)
  : Evaluate PK parameters
- [`p_state_occupancy()`](https://generable.github.io/bmstate/reference/p_state_occupancy.md)
  : Solve state occupancy probabilities for each subject and draw in
  'MultistateModelFit'
- [`p_state_visit()`](https://generable.github.io/bmstate/reference/p_state_visit.md)
  : For each non-source state, compute probability of visiting it at
  least once before given time
- [`p_state_visit_per_subject()`](https://generable.github.io/bmstate/reference/p_state_visit_per_subject.md)
  : For each subject, compute probability of visiting a given state at
  least once before given time
- [`pk_2cpt_pss()`](https://generable.github.io/bmstate/reference/pk_2cpt_pss.md)
  : Partially steady-state PK model
- [`plot_stan_data_integral()`](https://generable.github.io/bmstate/reference/plot_stan_data_integral.md)
  : Visualize numerical integration of hazard
- [`plot_stan_data_matrix()`](https://generable.github.io/bmstate/reference/plot_stan_data_matrix.md)
  : Visualize parts of the 'Stan' data
- [`plot_state_occupancy()`](https://generable.github.io/bmstate/reference/plot_state_occupancy.md)
  : Plot mean state occupancy probabilities over time for each subject
- [`potential_covariates()`](https://generable.github.io/bmstate/reference/potential_covariates.md)
  : Look for potential covariates that affect transitions
- [`simulate_dosing()`](https://generable.github.io/bmstate/reference/simulate_dosing.md)
  : Simulate dosing data
- [`simulate_example_data()`](https://generable.github.io/bmstate/reference/simulate_example_data.md)
  : Simulate example data
- [`solve_time_evolution()`](https://generable.github.io/bmstate/reference/solve_time_evolution.md)
  : Solve the Kolmogorov forward equation of a Markovian multistate
  system
- [`solve_trans_prob_matrix()`](https://generable.github.io/bmstate/reference/solve_trans_prob_matrix.md)
  : Solve the transition probability matrix for each given output time
- [`split_data()`](https://generable.github.io/bmstate/reference/split_data.md)
  : Train-test split
- [`transmat_full()`](https://generable.github.io/bmstate/reference/transmat.md)
  [`transmat_comprisk()`](https://generable.github.io/bmstate/reference/transmat.md)
  [`transmat_survival()`](https://generable.github.io/bmstate/reference/transmat.md)
  [`transmat_illnessdeath()`](https://generable.github.io/bmstate/reference/transmat.md)
  [`transmat_progression()`](https://generable.github.io/bmstate/reference/transmat.md)
  [`transmat_diamond()`](https://generable.github.io/bmstate/reference/transmat.md)
  : Create a common transition matrix

# Articles

### All vignettes

- [Time-to-event data analysis with the bmstate
  package](https://generable.github.io/bmstate/articles/analysis.md):
- [Exposure-hazard multistate modeling with
  bmstate](https://generable.github.io/bmstate/articles/exposure-hazard.md):
- [Mathematical description of models in the bmstate
  package](https://generable.github.io/bmstate/articles/math.md):
- [Survival data analysis with the bmstate
  package](https://generable.github.io/bmstate/articles/survival.md):
